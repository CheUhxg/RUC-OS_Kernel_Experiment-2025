#include <stdio.h>
#include <unistd.h>
#include <stdlib.h>
#include <signal.h>

// 自定义 SIGINT 信号处理函数
void handle_sigint(int sig) {
    printf("Received SIGINT (signal %d). Malware exit.\n", sig);
    fflush(stdout);  // 确保信息输出到终端
    sleep(1);
    exit(-1);
}

// 自定义 SIGUSR1 信号处理函数
void handle_sigusr1(int sig) {
    printf("Received SIGUSER1 (signal %d). Malware not exit.\n", sig);
    fflush(stdout);  // 确保信息输出到终端
    sleep(1);
}

int main() {
    printf("Malware process started. PID: %d\n", getpid());

    // 注册 SIGINT 信号处理器
    if (signal(SIGINT, handle_sigint) == SIG_ERR) {
        perror("Failed to register SIGINT handler");
        return 1;
    }

    // 注册 SIGUSER1 信号处理器
    if (signal(SIGUSR1, handle_sigusr1) == SIG_ERR) {
        perror("Failed to register SIGINT handler");
        return 1;
    }

    // 模拟 payload / 保持活动状态
    while (1) {
        sleep(1);
    }

    return 0;
}
